import re

_auto_comment = '/* This file was automatically generated by build.py */'
_builtins = {}
_macro = re.compile('\(\* (.*?) \*\)')


def expandmacro(infile, outfile, args=None):
    if args is None:
        args = _builtins
    else:
        args2 = _builtins.copy()
        args2.update(args)
        args = args2

    string = open(infile, encoding='utf8').read()

    string = _macro.sub(lambda x: args[x.group(1)], string)

    with open(outfile, 'w', encoding='utf8') as f:
        f.write(_auto_comment)
        f.write('\n')
        f.write(string)


def build(page):
    expandmacro('xpages/%s.js' % page, 'pages/%s.js' % page)


if __name__ == '__main__':
    build('index')
    build('rant')
